{"version":3,"names":["GET","cov_86odrvtod","f","s","_db","connectToDatabase","site","url","_settingactions","getSetting","baseUrl","b","products","_productmodel","default","find","isPublished","deletedAt","$exists","select","lean","xml","_routing","routing","locales","map","locale","Date","toISOString","altLocale","join","product","slug","updatedAt","_server","NextResponse","headers","error","console","status"],"sources":["/home/mark/Downloads/nextjs-amazona-main/app/api/sitemap/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { getSetting } from '@/lib/actions/setting.actions'\nimport Product from '@/lib/db/models/product.model'\nimport { connectToDatabase } from '@/lib/db'\nimport { routing } from '@/i18n/routing'\n\nexport async function GET() {\n  try {\n    await connectToDatabase()\n    const {\n      site: { url },\n    } = await getSetting()\n    const baseUrl = url || 'https://hager-zon.vercel.app'\n\n    const products = await Product.find({\n      isPublished: true,\n      deletedAt: { $exists: false },\n    })\n      .select('slug updatedAt')\n      .lean()\n\n    const xml = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\n        xmlns:xhtml=\"http://www.w3.org/1999/xhtml\">\n  ${routing.locales\n    .map(\n      (locale) => `\n    <url>\n      <loc>${baseUrl}/${locale}</loc>\n      <lastmod>${new Date().toISOString()}</lastmod>\n      <changefreq>daily</changefreq>\n      <priority>1.0</priority>\n      ${routing.locales\n        .map(\n          (altLocale) => `\n        <xhtml:link \n          rel=\"alternate\" \n          hreflang=\"${altLocale}\" \n          href=\"${baseUrl}/${altLocale}\"\n        />`\n        )\n        .join('')}\n    </url>\n  `\n    )\n    .join('')}\n  ${products\n    .map((product) =>\n      routing.locales\n        .map(\n          (locale) => `\n    <url>\n      <loc>${baseUrl}/${locale}/product/${product.slug}</loc>\n      <lastmod>${product.updatedAt?.toISOString() || new Date().toISOString()}</lastmod>\n      <changefreq>daily</changefreq>\n      <priority>0.8</priority>\n      ${routing.locales\n        .map(\n          (altLocale) => `\n        <xhtml:link \n          rel=\"alternate\" \n          hreflang=\"${altLocale}\" \n          href=\"${baseUrl}/${altLocale}/product/${product.slug}\"\n        />`\n        )\n        .join('')}\n    </url>\n  `\n        )\n        .join('')\n    )\n    .join('')}\n</urlset>`\n\n    return new NextResponse(xml, {\n      headers: {\n        'Content-Type': 'application/xml',\n        'Cache-Control': 'public, s-maxage=3600, stale-while-revalidate=59',\n      },\n    })\n  } catch (error) {\n    console.error('Error generating sitemap:', error)\n    return new NextResponse('Error generating sitemap', { status: 500 })\n  }\n}\n"],"mappings":"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","ignoreList":[]}